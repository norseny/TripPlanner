{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{% endblock %}

{% block content %}
    <h1>{% trans "Trip" %}</h1>

    <form action="" method="post">{% csrf_token %}
        <table class="table">
            {{ form }}
        </table>

        <button type="button" class="accordion" data-toggle="collapse" data-target="#journeys" aria-controls="journeys">{% trans 'Journeys' %}</button>
        <div class="collapse show" id="journeys">
            <table class="table">
                {{ journeys.management_form }}
                {% for form in journeys.forms %}
                    {% if forloop.first %}
                        <thead>
                        <tr>
                            {% for field in form.visible_fields %}
                                <th>{{ field.label|capfirst }}</th>
                            {% endfor %}
                        </tr>
                        </thead>
                    {% endif %}
                    <tr class="{% cycle row1 row2 %} formset_row1">
                        {% for field in form.visible_fields %}
                            <td>
                                {% if forloop.first %}
                                    {% for hidden in form.hidden_fields %}
                                        {{ hidden }}
                                    {% endfor %}
                                {% endif %}
                                {{ field }}
                                <div class="error-style">{{ field.errors.as_text }}</div>
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </table>
        </div>

        <button type="button" class="accordion" data-toggle="collapse" data-target="#accommodations">{% trans 'Accommodations' %}</button>
        <div class="collapse" id="accommodations">
            <table class="table">
                {{ accommodations.management_form }}
                {% for form in accommodations.forms %}
                    {% if forloop.first %}
                        <thead>
                        <tr>
                            {% for field in form.visible_fields %}
                                <th>{{ field.label|capfirst }}</th>
                            {% endfor %}
                        </tr>
                        </thead>
                    {% endif %}
                    <tr class="{% cycle row1 row2 %} formset_row2">
                        {% for field in form.visible_fields %}
                            <td>
                                {% if forloop.first %}
                                    {% for hidden in form.hidden_fields %}
                                        {{ hidden }}
                                    {% endfor %}
                                {% endif %}
                                {{ field }}
                                <div class="error-style">{{ field.errors.as_text }}</div>
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </table>
        </div>

        <button type="button" class="accordion" data-toggle="collapse" data-target="#attractions">{% trans 'Attractions' %}</button>
        <div class="collapse" id="attractions">
            <table class="table">
                {{ attractions.management_form }}
                {% for form in attractions.forms %}
                    {% if forloop.first %}
                        <thead>
                        <tr>
                            {% for field in form.visible_fields %}
                                <th>{{ field.label|capfirst }}</th>
                            {% endfor %}
                        </tr>
                        </thead>
                    {% endif %}
                    <tr class="{% cycle row1 row2 %} formset_row3">
                        {% for field in form.visible_fields %}
                            <td>
                                {% if forloop.first %}
                                    {% for hidden in form.hidden_fields %}
                                        {{ hidden }}
                                    {% endfor %}
                                {% endif %}
                                {{ field }}
                                <div class="error-style">{{ field.errors.as_text }}</div>
                                {# todo: gdy kopiuje sie wiersz, to bledy tez #}
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </table>
        </div>

        <div><input type="submit" value="Save"/></div>
        <div><a href="{% url 'trip-list' %}">{% trans 'Back to the list' %}</a></div>
    </form>
{% endblock %}

{% block js %}
    <script>const language_code = '{{ request.LANGUAGE_CODE }}';</script>
    <script src="{% static 'libs/formset/jquery.formset.js' %}"></script>
    <script src="{% static 'own/js/add_trip_attribute.js' %}"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pl.js"></script>
{% endblock %}