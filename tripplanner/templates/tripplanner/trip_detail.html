{% extends "base.html" %}

{% load i18n %}
{% load static %}

{% load custom_template_filters %}
{% block title %}{% endblock %}
{% block content %}

    <div class="row d-flex justify-content-center align-items-center m-3">
        <div class="col-1 text-left justify-content-center align-items-center">
            {% if prev_trip_id %}
                <a class="myicon" href="{% url 'trip-detail' prev_trip_id %}"><i
                        class="fas fa-angle-left fa-3x"></i></a>
            {% endif %}
        </div>
        <div class="col-10 text-center">
            <h1>{{ trip.name }} </h1>
        </div>
        <div class="col-1 text-right">
            {% if next_trip_id %}
                <a class="myicon" href="{% url 'trip-detail' next_trip_id %}"> <i
                        class="fas fa-angle-right fa-3x"></i></a>
            {% endif %}
        </div>
    </div>

    {% if user.is_authenticated %}
    {% if not participant %}
        <div class="text-right mr-5">
            {% if trip in user.profile.favourite_trips.all %}
                <a href="{% url 'my-fav-trip-list'%}"><span class="brown-font font-weight-400">{% trans 'In your favourites'%} <i class="fas fa-heart"></i></span></a>
            {% else %}
                <button type="button" class="btn btn-sm d-inline-block" id="add-to-fav-btn">{% trans 'Add to your favourites!'%}
                <i class="fas fa-heart"></i> </button>
                {% endif %}
        </div>
    {% endif %}
    {% endif %}

    <div class="row mt-3 mb-5 mr-5 ml-5">
        <div class="col-6 d-flex justify-content-center align-items-center pt-4">
            <div class="no-a-underline">
                <p class="details-main"><label>{% trans 'Description' %}:</label> {{ trip.more_info }} </p>
                <p class="details-main"><label>{% trans 'Created by' %}:</label> {{ trip.created_by }} </p>
                <p class="details-main">
                    <label>{% trans 'Start time' %}:</label> {{ trip.start_time|default_if_none:"" }} </p>
                <p class="details-main"><label>{% trans 'End time' %}:</label> {{ trip.end_time|default_if_none:"" }}
                </p>
                <p class="details-main">
                    <label>{% trans 'Total Cost (PLN)' %}:</label> {{ trip.price|default_if_none:"" }} </p>
                <div class="row justify-content-center align-items-center text-center mt-2">
                    <div class="col-6">
                        <a href="{% url 'trip-participants' trip.pk %}"><span class="myicon">
                            <p><i class="fas fa-users fa-3x d-inline-block"></i></p>
                            <p>{% trans 'Trip participants' %}</p>
                        </span></a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'trip-detail-pdf' trip.pk %}"><span class="myicon">
                            <p><i class="far fa-file-pdf fa-3x d-inline-block"></i></p>
                            <p>{% trans 'Pdf-file with details' %}</p>
                        </span></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-6 d-flex justify-content-center align-items-center text-center">
            {% if user.id == trip.created_by_id %}
                {% if trip.main_image %}
                    <div class="photo-container h-100 w-100 justify-content-center align-items-center text-center no-a-underline">
                        <img src='{{ trip.main_image.url }}'
                             alt="Trip main photo"
                             class="photo-img img-fluid mx-auto d-block">
                        <a href="{% url 'upload-trip-img' trip.pk %}">
                            <div class="overlay">
                                <div class="photo-text-over myicon">
                                    <p><i class="far fa-image fa-5x d-inline-block"></i></p>
                                    <p>{% trans "Change main image" %}</p>
                                </div>
                            </div>
                        </a>
                    </div>
                {% else %}
                    <div class="row h-100 justify-content-center align-items-center text-center no-a-underline">
                        <a href="{% url 'upload-trip-img' trip.pk %}"><span class="myicon">
                                <p>
                                    <i class="far fa-image fa-5x d-inline-block"></i>
                                    <i class="fas fa-plus fa-2x d-inline-block mb-5"></i>
                                </p>
                                <p>{% trans 'Add main image' %}</p>
                            </span></a>
                    </div>
                {% endif %}
            {% else %}
                {% if trip.main_image %}
                    <div class="photo-container h-100 w-100 justify-content-center align-items-center text-center">
                        <img src='{{ trip.main_image.url }}' alt="img" class="photo-img img-fluid mx-auto
                                                                               d-block">
                    </div>
                {% else %}
                    <div class="photo-container h-100 w-100 justify-content-center align-items-center text-center">
                        <img src='../../../media/users_img/default-photo.jpeg' alt="img" class="photo-img
                img-fluid mx-auto
                                                                               d-block">
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </div>

    <div class="details-with-acc m-">
        <div class="accordion d-flex justify-content-center text-center align-items-center" id="trip-details"
             onclick="openCloseDetails(event, 'trip-details-table')">
            <h2><span class="d-inline-block details-label">{% trans "Trip's Details" %}</span></h2>
            <i class="fas fa-angle-down fa-3x" id="icon-details-down-view"></i>
            <i class="fas fa-angle-up fa-3x" id="icon-details-up-view"></i>
        </div>
        <div class="scrollable-horizontally" id="trip-details-table" style="display: block">

            {% if trip.journey_set.all %}
                <div><i class="brown-font fas fa-rocket"></i></div>
                {% for el in trip.journey_set.all %}
                    <div class="row align-items-center">
                        <div class="col-1 py-1">{{ el.means_of_transport|default_if_none:"" }}</div>
                        <div class="col-4 pt-1">
                            {% if el.start_point %}
                                <span class="text-nowrap">{% trans 'from:' %} {{ el.start_point }}</span>
                            {% endif %}
                            {% if el.end_point %}
                                <span class="text-nowrap">{% trans 'to' %}: {{ el.end_point }}</span>
                            {% endif %}
                        </div>
                        <div class="col-5 text-center py-1">
                            {% if el.start_time %}
                                <span class="text-nowrap">{% trans 'from' %}: {{ el.start_time|date:"d/m/y (H:i)" }}</span>
                            {% endif %}
                            {% if el.end_time %}
                                <span class="text-nowrap">{% trans 'to' %}: {{ el.end_time|date:"d/m/y (H:i)" }}</span>
                            {% endif %}
                        </div>
                        <div class=" col-2 text-right py-1">{{ el.price|default_if_none:"" }}</div>
                    </div>
                    {% if el.more_info %}

                        {% if el.more_info|length < 50 %}
                            <div class="my-2 grey-border-bottom  font-small">{{ el.more_info }}</div>
                        {% else %}
                            <div class="my-2 grey-border-bottom  font-small d-flex">
                                {{ el.more_info|truncatewords:"5"|slice:"-3" }}
                                <div class="d-inline-block pb-1 pl-1">
                                <span class="icon-show-more position-absolute h5">
                                    <i class="fas fa-ellipsis-h myicon"></i>
                                </span>
                                </div>
                            </div>
                            <div class="my-2 grey-border-bottom more-info-to-show font-small"
                                 style="display: none">{{ el.more_info }}
                                <span class="icon-show-less myicon h5"><i class="fas fa-caret-left"></i></span>
                            </div>
                        {% endif %}
                    {% endif %}
                {% endfor %}
                {% if total_cost_journeys %}
                    <div class="text-right font-weight-400">{% trans 'Total' %} PLN: {{ total_cost_journeys }}</div>
                {% endif %}
            {% endif %}


            {% if trip.accommodation_set.all %}
                <div class="pt-3"><i class="brown-font fas fa-bed"></i></div>
                {% for el in trip.accommodation_set.all %}
                    <div class="row">
                        <div class="col-2 py-1">{{ el.name|default_if_none:"" }}</div>
                        <div class="col-3 py-1">{{ el.address|default_if_none:"" }}</div>
                        <div class="col-5 text-center py-1">
                            {% if el.start_time %}
                                <span class="text-nowrap">{% trans 'from' %}: {{ el.start_time|date:"d/m/y (H:i)" }}</span>
                            {% endif %}
                            {% if el.end_time %}
                                <span class="text-nowrap">{% trans 'to' %}: {{ el.end_time|date:"d/m/y (H:i)" }}</span>
                            {% endif %}
                        </div>
                        <div class=" col-2 text-right py-1">{{ el.price|default_if_none:"" }}</div>
                    </div>
                    {% if el.more_info %}

                        {% if el.more_info|length < 50 %}
                            <div class="my-2 grey-border-bottom  font-small">{{ el.more_info }}</div>
                        {% else %}
                            <div class="my-2 grey-border-bottom  font-small d-flex">
                                {{ el.more_info|truncatewords:"5"|slice:"-3" }}
                                <div class="d-inline-block pb-1 pl-1">
                                <span class="icon-show-more position-absolute h5">
                                    <i class="fas fa-ellipsis-h myicon"></i>
                                </span>
                                </div>
                            </div>
                            <div class="my-2 grey-border-bottom more-info-to-show font-small"
                                 style="display: none">{{ el.more_info }}
                                <span class="icon-show-less myicon h5"><i class="fas fa-caret-left"></i></span>
                            </div>
                        {% endif %}
                    {% endif %}
                {% endfor %}
                {% if total_cost_accommodations %}
                    <div class="text-right font-weight-400">{% trans 'Total' %}
                        PLN: {{ total_cost_accommodations }}</div>
                {% endif %}
            {% endif %}


            {% if trip.attraction_set.all %}
                <div class="pt-3"><i class="brown-font fas fa-camera"></i></div>
                {% for el in trip.attraction_set.all %}
                    <div class="row">
                        <div class="col-2 py-1">{{ el.name|default_if_none:"" }}</div>
                        <div class="col-4 py-1">{{ el.address|default_if_none:"" }}</div>
                        <div class="col-4 text-center py-1">
                            {{ el.start_time|date:"d.m.y (H:i)"|default_if_none:"" }}</div>
                        <div class=" col-2 text-right py-1">{{ el.price|default_if_none:"" }}</div>
                    </div>
                    {% if el.more_info %}
                        {% if el.more_info|length < 50 %}
                            <div class="my-2 grey-border-bottom  font-small">{{ el.more_info }}</div>
                        {% else %}
                            <div class="my-2 grey-border-bottom  font-small d-flex">
                                {{ el.more_info|truncatewords:"5"|slice:"-3" }}
                                <div class="d-inline-block pb-1 pl-1">
                                    <span class="icon-show-more position-absolute h5">
                                        <i class="fas fa-ellipsis-h myicon"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="my-2 grey-border-bottom more-info-to-show font-small"
                                 style="display: none">{{ el.more_info }}
                                <span class="icon-show-less myicon h5"><i class="fas fa-caret-left"></i></span>
                            </div>
                        {% endif %}
                    {% endif %}
                {% endfor %}
                {% if total_cost_attractions %}
                    <div class="text-right font-weight-400">{% trans 'Total' %} PLN: {{ total_cost_attractions }}</div>
                {% endif %}
            {% endif %}


        </div>

    </div>

    <div class="m-5 no-a-underline">
        {% if  participant %}
            <div class="row w-100 justify-content-center text-center details-main-icons m-1">

                <div class="col-3">
                    <a href="{% url 'trip-update' trip.pk %}"><span class="myicon">
                            <p><i class="far fa-edit fa-3x d-inline-block"></i></p>
                            <p>{% trans 'Edit' %}</p>
                        </span></a>
                </div>
                {% if user.id == trip.created_by_id %}
                    <div class="col-3">
                        <a href="{% url 'trip-delete' trip.pk %}"><span class="myicon">
                            <p><i class="far fa-trash-alt fa-3x d-inline-block"></i></p>
                            <p>{% trans 'Delete' %}</p>
                        </span></a>
                    </div>
                {% endif %}
            </div>
        {% else %}
            <div class="row h-100 w-100 align-items-center text-center details-main-icons">
                <div class="col-12 d-inline-block">
                    <a id="inspired" href=#><span class="myicon">
                    <p><i class="far fa-smile fa-5x d-inline-block"></i><i
                            class="far fa-lightbulb fa-3x d-inline-block mb-5"></i></p>
                    <p>{% trans 'Inspired? Plan a similar trip!' %}</p>
                </span></a>
                </div>
            </div>
        {% endif %}
    </div>


{% endblock %}

{% block js %}

    <script>const trip_id = '{{ trip.id }}'</script>
    <script src="{% static 'own/js/detail-view.js' %}"></script>

{% endblock %}